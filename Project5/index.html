<!doctype html>
<html lang="en">
	<head>
	    <meta charset="utf-8">
	    <meta name="keywords" content="">
	    <meta name="description" content="">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	    
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="css/style.css">    

		<title>Orinoco - Oak furniture store</title>
	</head>
	<body class="mx-auto">
		<header class="container-fluid mb-5">
			<nav class="navbar navbar-expand-lg">
				<div class="col-2">
					<a class="navbar-brand mw-25" href="index.html">
			            <img src="images/orinoco-logo.png" height="60" alt="Orinoco Logo" />
			        </a>
				</div>
				<div class="col-8 text-center">
					<h2>Oak furniture with character</h2>
				</div>
				<div class="col-2">
					<ul>
						<li class="d-inline-block px-2"><a href="index.html" class="text-dark">Home</a></li>
						<li class="d-inline-block cart px-2">
							<a href="cart.html" class="text-primary"><i class="fa fa-shopping-cart pr-1"></i>Cart<span class="pl-1">0</span></a>
						</li>
					</ul>
				</div>
			</nav>
		</header>

		<div id="item-detailed-view" class="item-detailed-view">
			<div class="item-detailed-view-header">
				<h3 id="item-detailed-view-header--title" class="item-detailed-view-header--title">" "</h3>
				<button id="item-detailed-view--close" class="close-button">&times;</button>
			</div>
			<div class="item-detailed-view-body">
				<img src="" id="item-detailed-view-body--img" class="item-detailed-view-body--img col-6">
				<ul class="d-flex flex-column col-6">
					<li id="item-detailed-view-body--description" class="item-detailed-view-body--description">Description: </li>
					<li id="item-detailed-view-body--price" class="item-detailed-view-body--price">Price: </li>
					<li id="item-detailed-view-body--varnish" class="item-detailed-view-body--varnish">Varnish: </li>
					<li class="btn add-to-cart">Add to Cart</li>
				</ul>
			</div>
		</div>

		<div class="overlay" id="overlay"></div>
	
		<div class="container">
			<div class="row mb-5">
				<div class="col text-center">
					<!-- <h2 class="title">
						Orinoco - Oak furniture with character
					</h2>
					<h4 class="subtitle">
						Hand-built with pride
					</h4> -->
					<div id="carouselControls" class="carousel slide" data-ride="carousel" data-interval="3500">
				        <ol class="carousel-indicators">
				            <li data-target="#carouselControls" data-slide-to="0" class="active"></li>
				            <li data-target="#carouselControls" data-slide-to="1"></li>
				            <li data-target="#carouselControls" data-slide-to="2"></li>
				        </ol>
				        <div id="carousel" class="carousel-inner" style="height: 60vh">

					        <a class="carousel-control-prev" href="#carouselControls" role="button" data-slide="prev">
					            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
					        	<span class="sr-only">Previous</span>
					        </a>
					        <a class="carousel-control-next" href="#carouselControls" role="button" data-slide="next">
						        <span class="carousel-control-next-icon" aria-hidden="true"></span>
						        <span class="sr-only">Next</span>
					        </a>   
				        </div>
					</div>
				</div>
			</div>
			<div class="row mt-2">
				<div class="col-12 col-lg-4">
			        <div class="mb-4 mb-lg-0 border-primary border-right">
			        	<div class="col-3 d-inline-block">
			          		<img src="images/delivery.png" alt="delivery" class="card-img-top">
			          	</div>
			          	<div class="col-8 d-inline-block card-body float-right">
				          <h5 class="card-text">
				          	Free delivery on all orders
				          </h5>
				      	</div>
			        </div>
			    </div>
			    <div class="col-12 col-lg-4">
			        <div class="mb-4 mb-lg-0 border-primary border-right">
			          	<div class="col-3 d-inline-block">
			          		<img src="images/customizable.png" alt="customizable" class="card-img-top">
			          	</div>
			          	<div class="col-8 d-inline-block card-body float-right">
				          <h5 class="card-text">
				          	Made to measure
				          </h5>
				      	</div>
			        </div>
			    </div>
			    <div class="col-12 col-lg-4">
			        <div class="mb-4 mb-lg-0">
			            <div class="col-3 d-inline-block">
			          		<img src="images/affordable.png" alt="affordable" class="card-img-top">
			          	</div>
			          	<div class="col-8 d-inline-block card-body float-right">
				          <h5 class="card-text">
				          	0% finance available
				          </h5>
				      	</div>
				    </div>
			    </div>
			</div>
			<div class="row" height="100px">
				<a href="#list" class="mx-auto my-3">
					<button type="button" class="btn-primary">View range</button>
				</a>
			</div>
			<div id="list" class="range row mt-4">
			</div>
		</div>

		<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

		<script type="text/javascript">
			const list = document.getElementById("list");
			const carousel = document.getElementById("carousel");
			const itemDetailedView = document.getElementById("item-detailed-view");
			const popupOverlay = document.getElementById("overlay")
			const itemDetailedViewCloseButton = document.getElementById("item-detailed-view--close");
			let apiRequest = new XMLHttpRequest();

			apiRequest.open('GET', 'http://localhost:3000/api/furniture/');
			apiRequest.send();

			apiRequest.onreadystatechange = () => {
				if (apiRequest.status === 404) {
					// handle "Not Found"
					// returned
				}
				if (apiRequest.readyState === 4) {
					const response = JSON.parse(apiRequest.response);
					// list.textContent = response[1].varnish;

					// handle a case when fewer than 3 items are returned
					for (let i = 0; i < 3; i++) {
						addElementCarousel(response[i], i);
					}
					for (let item of response) {
						addImg(item);
					}
				}

				const openDetailedView = document.querySelectorAll(".list-item");

				for (let i = 0; i < openDetailedView.length; i++) {
					openDetailedView[i].addEventListener('click', () => {
						// const item = document.querySelector(openDetailedView[i]);
						console.log(openDetailedView[i].dataset.id);

						itemDetailedView.classList.add('item-detailed-view-active');
						popupOverlay.classList.add('overlay-active');
						detailedView(openDetailedView[i]);
					});
				}
			};

			function detailedView(item) {
				if (item == null) return;

				const id = item.dataset.id;
				const name = item.dataset.name;
				const description = item.dataset.description;
				const price = item.dataset.price;
				const varnish = item.dataset.varnish;
				const img = item.dataset.img;
					
				const popupWindowTitle = document.getElementById('item-detailed-view-header--title');
				const popupWindowPrice = document.getElementById('item-detailed-view-body--price');
				const popupWindowDescription = document.getElementById('item-detailed-view-body--description');
				const popupWindowVarnish = document.getElementById('item-detailed-view-body--varnish');
				const popupWindowImg = document.getElementById('item-detailed-view-body--img');

				popupWindowTitle.innerHTML = name;
				popupWindowPrice.innerHTML += price + "$";
				popupWindowDescription.innerHTML += description;
				popupWindowImg.src = img;
				popupWindowVarnish.innerHTML += varnish;

				itemDetailedView.classList.add('active');
				popupOverlay.classList.add('active');

				itemDetailedViewCloseButton.addEventListener('click', () => {
					console.log("clicked");
					closePopupWindow();
				})

			}

			function closePopupWindow () {
				itemDetailedView.classList.remove('item-detailed-view-active');
				popupOverlay.classList.remove('overlay-active');
			}


			function addElementCarousel(item, itemNumber) {
				// create product div
				let product = document.createElement("div");
				product.className += "carousel-item";

				if (itemNumber === 0) product.classList.add("active");

				const img = document.createElement("img");
				img.src = item.imageUrl;
				img.className += "d-block mx-auto w-100";
				// add alt
				product.appendChild(img);
				carousel.appendChild(product);
			}
			function addImg(item) {
				const product = document.createElement("a");
				product.className += "container list-item col-4 border p-2";
				product.style.height = "250px";
				product.style.width = "250px";
				product.setAttribute("data-id", item._id);
				product.setAttribute("data-price", item.price);
				product.setAttribute("data-description", item.description);
				product.setAttribute("data-varnish", item.varnish);
				product.setAttribute("data-name", item.name);
				product.setAttribute("data-img", item.imageUrl);
				//product.href = "item.html";

				const img = document.createElement("img");
				img.src = item.imageUrl;
				img.className += "mx-auto h-100 w-100 list-item-image";
				// add alt
				product.appendChild(img);

				const title = document.createElement("div");
				title.className += "product-toggle-title";
				// these two are separate elements to enable CSS transformation
				const h3 = document.createElement("h3");
				h3.className += "product-toggle-title--title";
				h3.innerHTML = item.name;
				title.appendChild(h3);
				product.appendChild(title);

				list.appendChild(product);
			}

			function addElement(item) {
				// create product div
				let product = document.createElement("div");
				product.className += "list-item col-4 border p-2";

				product.setAttribute("data-id", item._id);
				// product.appendChild(addRow("ID", item._id));
				product.appendChild(addRow("Name", item.name));
				product.appendChild(addRow("Varnish", item.varnish));
				product.appendChild(addRow("Price", item.price));
				product.appendChild(addRow("Description", item.description));
					
					// product.innerHTML = "Product ID: " + item._id + '<br />' + "Varnish: " + item.varnish + '<br />' + "name: " + item.name + '<br />' + "price: " + item.price + "$" + '<br />' + "description: " + item.description + '<br />' + '<br />';
				list.appendChild(product);
			}

			function addRow(name, arg) {
				let row = document.createElement("div");
				const lowerCaseName = name.toLowerCase();
				row.className += "row " + lowerCaseName;

				// add dolar sign
				if (name === "Price") arg += "$";

				let col1 = addCol(name, true);
				let col2 = addCol(arg, false);

				row.appendChild(col1);
				row.appendChild(col2);

				return row;
			}

			function addCol(data, title) {
				let col = document.createElement("div");
				col.className += "col-sm ";
				col.innerHTML = data;
				if (title) col.innerHTML += ":";

				return col;
			}
		</script>
	</body>
</html>